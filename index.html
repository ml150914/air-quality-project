<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Air Quality Monitor</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h1>Air Quality Monitor</h1>
  <div id="plot" style="width: 90%; height: 600px; margin: auto;"></div>

  <script>
    //  MODIFICA QUI IL NOME DEL FILE (può essere anche dinamico)
    const filename = '2025-08-27.csv';
    document.getElementById('plot').innerText = 'Uploating ' + filename + '...';
    console.log('Fetching:', filename);

    fetch(filename)
      .then(response => {
        if (!response.ok) {
          throw new Error("CSV file not found or inaccessible: " + filename);
        }
        return response.text();
      })
      .then(csv => {
        const lines = csv.trim().split('\n');
        
        // Assumiamo intestazioni: timestamp,temperature,humidity,pressure,pm1.0,pm2.5,pm10
        const time = [], temp = [], hum = [], pm25 = [];

        for (let i = 1; i < lines.length; i++) {
          const [timestamp, temperature, humidity, , , pm_2_5] = lines[i].split(',');
          time.push(timestamp);
          temp.push(parseFloat(temperature));
          hum.push(parseFloat(humidity));
          pm25.push(parseFloat(pm_2_5));
        }

        const traces = [
          {
            x: time,
            y: temp,
            name: 'Temperature (°C)',
            type: 'scatter',
            mode: 'lines+markers'
          },
          {
            x: time,
            y: hum,
            name: 'Humidity (%)',
            type: 'scatter',
            mode: 'lines+markers'
          },
          {
            x: time,
            y: pm25,
            name: 'PM2.5',
            type: 'scatter',
            mode: 'lines+markers'
          }
        ];

        Plotly.newPlot('plot', traces, {
          title: 'Sensor Data — ' + filename,
          xaxis: { title: 'Time' },
          yaxis: { title: 'Value' }
        });
      })
      .catch(error => {
        document.getElementById('plot').innerText = error.message;
        console.error(error);
      });
  </script>
</body>
</html>

